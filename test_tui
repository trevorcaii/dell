import curses
from datetime import datetime
import gpu_burn_script

def main(stdscr):
    curses.echo()

    # Colors and border setup
    curses.start_color()
    curses.init_pair(1, curses.COLOR_WHITE, curses.COLOR_BLUE)
    curses.init_pair(2, curses.COLOR_BLACK, curses.COLOR_CYAN)
    stdscr.bkgd(curses.color_pair(1))

    # Function to display a box with a title
    def display_box(window, title=""):
        window.attron(curses.color_pair(2))
        window.border(0)
        window.addstr(0, 2, f' {title} ')
        window.attroff(curses.color_pair(2))
        window.refresh()
    
    gpu_info_list = gpu_burn_script.gpu_traverse_up()

    gpu_window_height = len(gpu_info_list) + 4
    gpu_window_width = 65
    gpu_window_border = curses.newwin(gpu_window_height, gpu_window_width, 1, 1)
    display_box(gpu_window_border, "GPU Info")
    gpu_window = curses.newwin(gpu_window_height-1, gpu_window_width-1, 2, 2)
    for i, gpu_info in enumerate(gpu_info_list):
        gpu_print = f"GPU {i}\t|\tBDF: {gpu_info[0]}\t|\tSlot: {gpu_info[1]}\t|\tRoot Port: {gpu_info[2]}"
        gpu_window.addstr(i, 0, gpu_print.expandtabs(3))
    gpu_window_border.refresh()
    gpu_window.refresh()

curses.wrapper(main)
